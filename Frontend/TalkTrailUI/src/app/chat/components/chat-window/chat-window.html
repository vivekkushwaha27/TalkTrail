<div class="chat-window">
  <div class="chat-header">
    <h3>{{ getTitle() }}</h3>
  </div>

  <div class="messages">
    <div
      class="message"
      *ngFor="let msg of messages"
      [ngClass]="{
        'message-mine': msg.senderId === currentUser?.id || msg.sender_id === currentUser?.id,
        'message-other': msg.senderId !== currentUser?.id && msg.sender_id !== currentUser?.id
      }"
    >
      <div *ngIf="selectedGroup && (msg.senderName || msg.sender_name)" class="sender-name">
        {{ msg.senderName || msg.sender_name }}
      </div>

      <div class="message-text">
        {{ msg.message }}
      </div>

      <div class="message-meta">
        <span class="time">
          <!-- time from API if provided, fallback to now -->
          {{ (msg.sent_time || msg.sentTime) || '' }}
        </span>
        <span
          class="delete"
          *ngIf="msg.senderId === currentUser?.id || msg.sender_id === currentUser?.id"
          (click)="onDelete(msg)"
          title="Delete message"
        >ğŸ—‘</span>
      </div>
    </div>
    <div #bottomRef></div>
  </div>

  <div class="message-input-container" *ngIf="selectedUser || selectedGroup">
    <input
      class="message-input"
      [(ngModel)]="newMessage"
      placeholder="Type a message..."
      (keydown.enter)="onSend()" />
    <button class="send-button" (click)="onSend()">Send</button>
  </div>

  <div class="empty-state" *ngIf="!selectedUser && !selectedGroup">
    <h3>Select a user or group to start chatting</h3>
  </div>
</div>
